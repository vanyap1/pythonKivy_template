<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>Command interface</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        function sendCommand(command) {
            const commandText = document.getElementById('commandDropdown').value;
            //const slotName = document.getElementById('slotsDropdown').value;
            let url = '';
            //if (slotName) {
            //    url += slotName + '/';
            //}
            url += command;
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('result').innerText = data;
                })
                .catch(error => {
                    document.getElementById('result').innerText = 'Error: ' + error;
                });
        }
        function uploadCalibFile() {
        const fileInput = document.getElementById('calibFile');
        if (fileInput.files.length === 0) {
            document.getElementById('uploadResult').innerText = 'No file selected';
            return;
        }
        const formData = new FormData();
        formData.append('calibFile', fileInput.files[0]);
        fetch('/upload_calib', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            document.getElementById('uploadResult').innerText = data;
        })
        .catch(error => {
            document.getElementById('uploadResult').innerText = 'Error: ' + error;
        });
        }
        function onOkButtonClick() {
            const command = document.getElementById('commandInput').value;
            const commandText = document.getElementById('commandDropdown').value;

            if (commandText === 'cmd' || commandText === 'exec') {
                if (command) {
                    sendCommand('/' + commandText + ':' + command);
                    return;
                } else {
                    sendCommand('/' + commandText);
                    return;
                }
            } else if (commandText === 'cmd' ||  commandText === 'id' ||  commandText === 'tel') {
                if (command) {
                    sendCommand('/' + commandText + ':' + command);
                    return;
                } else {
                    sendCommand('/' + commandText);
                    return;
                }

            } else {
                sendCommand('/' + commandText);
                return;
            }
        }

        function onButtonClick(buttonId) {
            document.getElementById('commandInput').value = buttonId;
            updateCommandExample();
            sendCommand('/cmd:' + buttonId);
        }

        function executeCommand(command) {
            let cmdLine = '/exec:' + command;
            document.getElementById('commandExample').innerText = cmdLine;
            sendCommand(cmdLine);
        }
        
        function sendConsoleCommand() {
            const cmd = document.getElementById('consoleInput').value;
            if (cmd.trim() === '') return;
            sendCommand('/exec:' + cmd);
            document.getElementById('consoleInput').value = '';
        }

        function updateCommandExample() {
            const command = document.getElementById('commandInput').value;
            const commandText = document.getElementById('commandDropdown').value;
            //const slotName = document.getElementById('slotsDropdown').value;
            let example = '/';
            //if (slotName) {
            //    example += slotName + '/';
            //}
            if (commandText === 'cmd' || 
            commandText === 'id' || 
            commandText === 'tel') {
                if (command) {
                    example += commandText + ':' + command;
                } else {
                    example += commandText;
                }
            } else if (commandText === 'exec') {
                if (command) {
                    example += commandText + ':' + command;
                } else {
                    example += commandText;
                }
            } else {
                example += commandText;
            }
            document.getElementById('commandExample').innerText = example;
        }
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const button = document.getElementById('toggleDarkModeButton');
            if (document.body.classList.contains('dark-mode')) {
                button.innerText = 'Light Mode';
            } else {
                button.innerText = 'Dark Mode';
            }
        }

        function saveNotes() {
            const notesContent = document.getElementById('notes').value;
            const url = '/cmd:saveNotes:' + encodeURIComponent(notesContent);
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('result').innerText = 'Notes saved: ' + data;
                })
                .catch(error => {
                    document.getElementById('result').innerText = 'Error saving notes: ' + error;
                });
        }

        function loadNotes() {
            const url = '/cmd:getNotes';
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('notes').value = data;
                })
                .catch(error => {
                    document.getElementById('result').innerText = 'Error loading notes: ' + error;
                });
        }

        function toggleNotes() {
            const content = document.getElementById('notesContent');
            const icon = document.getElementById('notesToggleIcon');
    
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.classList.add('rotated');
            } else {
                content.style.display = 'none';
                icon.classList.remove('rotated');
            }
        }

function clearNotes() {
    if (confirm('Are you sure you want to clear all notes?')) {
        document.getElementById('notes').value = '';
    }
}
        window.onload = loadNotes;
    </script>
</head>

<body class="dark-mode">
    <div class="container">
        <h1>RemoteControl Center Pro</h1>
        <div class="input-group">
            <!--
            <select id="slotsDropdown" onchange="updateCommandExample()">
                <option value="">none</option>
                <option value="slot1">slot1</option>
                <option value="slot2">slot2</option>
            </select>
            -->
            <select id="commandDropdown" onchange="updateCommandExample()">
                <option value="cmd">cmd</option>
                <option value="exec">exec</option>
                
                
            </select>
            <input type="text" id="commandInput" placeholder="Type your command" oninput="updateCommandExample()">
            <button class="button-exec" onclick="onOkButtonClick()">EXEC</button>
        </div>

        <div class="button-group">
            <!-- Pan tilt controll group-->
            <button class="button button-warning" onclick="onButtonClick('X-1000')">X-1000</button>
            <button class="button button-warning" onclick="onButtonClick('X-100')">X-100</button>
            <button class="button button-warning" onclick="onButtonClick('X-10')">X-10</button>
            <button class="button button-warning" onclick="onButtonClick('X-1')">X-1</button>
            <button class="button button-warning" onclick="onButtonClick('HOME')">H</button>
            <button class="button button-warning" onclick="onButtonClick('X+1')">X+1</button>
            <button class="button button-warning" onclick="onButtonClick('X+10')">X+10</button>
            <button class="button button-warning" onclick="onButtonClick('X+100')">X+100</button>
            <button class="button button-warning" onclick="onButtonClick('X+1000')">X+1000</button>

            <button class="button button-warning" onclick="onButtonClick('Y-1000')">Y-1000</button>
            <button class="button button-warning" onclick="onButtonClick('Y-100')">Y-100</button>
            <button class="button button-warning" onclick="onButtonClick('Y-10')">Y-10</button>
            <button class="button button-warning" onclick="onButtonClick('Y-1')">Y-1</button>
            <button class="button button-warning" onclick="onButtonClick('HOME')">H</button>
            <button class="button button-warning" onclick="onButtonClick('Y+1')">Y+1</button>
            <button class="button button-warning" onclick="onButtonClick('Y+10')">Y+10</button>
            <button class="button button-warning" onclick="onButtonClick('Y+100')">Y+100</button>
            <button class="button button-warning" onclick="onButtonClick('Y+1000')">Y+1000</button>
        </div>
        <div class="button-group">
            <button class="button button-warning" onclick="onButtonClick('setMem')">Set</button>
            <button class="button button-info" onclick="onButtonClick('mem:1')">M1</button>
            <button class="button button-info" onclick="onButtonClick('mem:2')">M2</button>
            <button class="button button-info" onclick="onButtonClick('mem:3')">M3</button>
            <button class="button button-info" onclick="onButtonClick('mem:4')">M4</button>
            <button class="button button-info" onclick="onButtonClick('mem:5')">M5</button>
            <button class="button button-info" onclick="onButtonClick('mem:6')">M6</button>
            <button class="button button-info" onclick="onButtonClick('mem:7')">M7</button>
            <button class="button button-info" onclick="onButtonClick('mem:8')">M8</button>
        </div>

        <div class="result-group">
            <h2 class="h2-success">Command example:</h2>
            <pre id="commandExample">/cmd:</pre>
        </div>
        

        <div class="console-group">
            <pre id="result">No data</pre>
            <div class="console-input-row">
                <input type="text" id="consoleInput" class="console-input" placeholder="Type command here..." onkeydown="if(event.key==='Enter'){sendConsoleCommand();}">
                <button class="console-btn" onclick="sendConsoleCommand()">
                <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        
        
        <div class="button-group">
            <button class="button button-primary" onclick="onButtonClick('test')">Test</button>
            <button class="button button-info" onclick="executeCommand('i2cdetect -y 2')">i2c Scan</button>
            <button class="button button-warning" onclick="onButtonClick('ch=1;value=1')">Set IO</button>
            <button class="button button-warning" onclick="onButtonClick('ch=1;value=0')">Reset IO</button>
            <button class="button button-info" id="toggleDarkModeButton" onclick="toggleDarkMode()">Light Mode</button>
            
        </div>
        <div class="notes-group">
            <div class="notes-header" onclick="toggleNotes()">
                <h2><i class="fas fa-sticky-note"></i> Notes</h2>
                <i class="fas fa-chevron-down notes-toggle-icon" id="notesToggleIcon"></i>
            </div>
            <div class="notes-content" id="notesContent" style="display: none;">
                <textarea id="notes" class="textarea-notes" placeholder="Write your notes here..."></textarea>
                <div class="notes-controls">
                    <button class="button-success" onclick="saveNotes()">
                        <i class="fas fa-save"></i> Save Notes
                    </button>
                    <button class="button-secondary" onclick="clearNotes()">
                        <i class="fas fa-eraser"></i> Clear
                    </button>
                </div>
            </div>
        </div>
        <div class="upload-group" style="margin-top: 20px;">
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="calibFile" name="calibFile" />
                <button type="button" class="button button-success" onclick="uploadCalibFile()">Upload Calibration</button>
            </form>
        <div id="uploadResult"></div>
</div>
    </div>
</body>

</html>